
@model IEnumerable<ENTIDAD.Facilidades>

    <div class="container ">
        <br>
        <br>
        <br>
        <center>
            <a class="" data-toggle="modal" data-target="#exampleModal2">Agregar nueva <img src="~/Content/img/add.svg" width="30" height="30" /></a>
        </center>
        <br>

        <div class="row">

            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Reglas</th>
                        <th scope="col">Imagen</th>
                        <th scope="col">Detalles</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var dato in Model)

                    {
                        <tr>
                            <th>@dato.id_Facilidades</th>
                            <th>@dato.nombre</th>
                            <td>@dato.reglas</td>
                            <th> <img src="@dato.urlImg" class="card-img-top" width="40" height="120"></th>
                            <td>@dato.detalles</td>
                            <td>
                                <a href="@Url.Action("eliminarFacilidad", "Contenido", new { id = @dato.id_Facilidades})">
                                    @*@Html.ActionLink("Contenido", "eliminarSobreNosotros", new { idImagen = @item.idImagen }, new { @class = "btn btn-danger" }, new{@src=""})*@

                                    <img src="~/Content/img/eliminar.svg" width="30" height="30" />
                                </a>
                            </td>
                            <td>
                                <a class="" data-toggle="modal" data-target="#exampleModal"
                                   onclick="return mifuncion(@Html.DisplayFor(modelItem => dato.id_Facilidades),
                                                         '@Html.DisplayFor(modelItem => dato.nombre)',
                                                         '@Html.DisplayFor(modelItem => dato.reglas)',
                                                         '@Html.DisplayFor(modelItem => dato.urlImg)',
                                                         '@Html.DisplayFor(modelItem => dato.detalles)')"> <img src="~/Content/img/mod1.svg" width="30" height="30" /></a>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>

            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Modificar Facilidad</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <input type="hidden" class="form-control" id="idf" name="idf">
                                <label>Nombre Facilidad</label>
                                <input type="text" class="form-control" id="nombre" name="nombre">
                                <br>
                                <label>Reglas</label>
                                <input type="text" class="form-control" id="regla" name="regla">
                                <br>
                                <div class="container">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <input id="modalimgtem" name="modalimgtem" type="hidden">
                                                <img name="modalimg" id="modalimg" width="100" height="100" />
                                            </div>
                                            <div class="form-group">
                                                <div class="custom-file">
                                                    <input type="file" class="custom-file-input" id="fileUpload" name="fileUpload">
                                                    <label class="custom-file-label" for="customFile">Cambiar Imagen</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <label>Detalles</label>
                                <textarea type="text" class="form-control" id="detalle" name="detalle"> </textarea>
                                <br>

                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                            <button type="button" id="btn" name="btn" class="btn btn-warning">Guadar Cambios</button>
                        </div>
                    </div>
                </div>
            </div>



            <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Registrar Facilidad</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <label>Nombre Facilidad</label>
                                <input type="text" class="form-control" id="nombre2" name="nombre2" required>
                                <br>
                                <label>Reglas</label>
                                <input type="text" class="form-control" id="regla2" name="regla2" required>
                                <br>
                                <div class="container">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="custom-file">
                                                    <input type="file" class="custom-file-input" id="fileUpload2" name="fileUpload2" required>
                                                    <label class="custom-file-label" for="customFile">Subir Imagen</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <label>Detalles</label>
                                <textarea type="text" class="form-control" id="detalle2" name="detalle2" required> </textarea>
                                <br>

                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">X</button>
                            <button type="button" id="btn2" name="btn" class="btn btn-primary">Agregar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


<script src="~/Scripts/jquery-3.3.1.js"></script>
<script type="text/javascript">
    function mifuncion(id, nombre, reglas, img, detalle) {
                var img2 = img.substring(10, img.length);
                $("#idf").val(id);
                $("#nombre").val(nombre);
                $("#regla").val(reglas);
                $("#detalle").val(detalle);
                var newRuta = "/Content/img/" + img2;
        $("#modalimg").attr("src", newRuta);
        $("#modalimgtem").val(img2);
    }
      $(document).ready(function (){

                        $("#btn").click(function (){
                            var selectFile = ($("#fileUpload"))[0].files[0];
                            var dataString = new FormData();

                            var id = $("#idf").val();
                            var nombre = $("#nombre").val();
                            var regla =  $("#regla").val();
                            var detalle = $("#detalle").val();
                            var imagen = $("#modalimgtem").val();

                    
                            dataString.append("fileUpload", selectFile);
                            dataString.append("idf", id);
                            dataString.append("nombre", nombre);
                            dataString.append("regla", regla);
                            dataString.append("detalle", detalle);
                            dataString.append("img", imagen);

                            $.ajax({

                                url: '@Url.Action("ModificarFacilidades", "Contenido")',
                                type: 'POST',
                                data: dataString,
                                contentType: false,
                                processData: false,
                                async: false,
                                success: function () {
                                    alert('Se ha modificado exitosamente');
                                    $("#alertControl").html('<div class="alert alert-success" id="alert">' + 'Exito' + '</div>');
                                    if (typeof (data.Value) != "undefined") {
                                        alert(data.Message);
                                    } else { alert('Imagen Subida con exito'); }
                                },
                                error: function (data) {
                                }
                            });
                        });

                    });
              
</script>


<script type="text/javascript">
       $(document).ready(function (){

                        $("#btn2").click(function (){
                            var selectFile = ($("#fileUpload2"))[0].files[0];
                            var dataString = new FormData();

                            var nombre = $("#nombre2").val();
                            var regla =  $("#regla2").val();
                            var detalle = $("#detalle2").val();

                            dataString.append("fileUpload", selectFile);
                            dataString.append("nombre", nombre);
                            dataString.append("regla", regla);
                            dataString.append("detalle", detalle);

                            $.ajax({

                                url: '@Url.Action("RegistrarFacilidades", "Contenido")',
                                type: 'POST',
                                data: dataString,
                                contentType: false,
                                processData: false,
                                async: false,
                                success: function () {
                                    alert('Registrado con exito');
                                    $("#alertControl").html('<div class="alert alert-success" id="alert">' + 'Exito' + '</div>');
                                    if (typeof (data.Value) != "undefined") {
                                        alert(data.Message);
                                    } else { alert('Imagen Subida con exito'); }
                                },
                                error: function (data) {
                                }
                            });
                        });

                    });

</script>